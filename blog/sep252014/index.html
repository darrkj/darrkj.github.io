<!DOCTYPE html>
<!-- saved from url=(0014)about:internet -->
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta http-equiv="x-ua-compatible" content="IE=9" >

    <title>Movie Net</title>

    <link rel="stylesheet" type="text/css" href="../../stylesheets/blog.css">

    <!-- Styles for R syntax highlighter -->
    <link rel="stylesheet" type="text/css" href="../../stylesheets/blog2.css">

    <link rel="stylesheet" type="text/css" href="../../stylesheets/stylesheet.css" media="screen" />
    
    <link rel="stylesheet" type="text/css" href="../../stylesheets/pygment_trac.css" media="screen" />
    
    <link rel="stylesheet" type="text/css" href="../../stylesheets/print.css" media="print" />

    <!-- R syntax highlighter -->
    <script src="../../javascripts/r.js"></script>
  </head>

  <body>

  <div class="container">

    <header>
      <div class="container">
        <h1>Interactive Movie Network</h1>
        <h2></h2>

        <h4 class="author"><em>Kenny Darrell</em></h4>
        <h4 class="date"><em>Sept 25, 2014</em></h4>
        </section>
      </div>
    </header>
    
    

<p>I just created an account on <a href="https://www.shinyapps.io/">shinyapps</a>. It seems pretty easy to launch an app that can be hosted here. I have heard the term <a href="http://en.wikipedia.org/wiki/Platform_as_a_service"> Platform as a Servece</a>, or more succinctly PaaS, but never really new what it meant. It seems cool though, htey offer the platform and you deploy applications onto it. It takes care of all of the overhead type stuff, you only need to focus on a the core what the app does. There is a great <a href="http://shiny.rstudio.com/articles/shinyapps.html">tutorial</a> that can be found on the Shiny website fo rhow to get started.</p>

<p>I am going to take a break from my last few posts about temporal type data and jump back to one of my other interests, graph data. I used the social network graph of <a href="http://moviegalaxies.com/movies/660-Pulp-Fiction">Pulp Fiction</a> from <a href="http://www.moviegalaxies.com">moviegalaxies.com</a> to explore a bunch of graph related technologies. I thought it would be cool to create an interactive application using <a href="http://d3js.org/">d3</a> and <a href="http://shiny.rstudio.com/">Shiny</a> to show off this technology using a bunch of movie network.</p>

<p>The app uses a lot of code a mentioned in prior posts, mainly how to get gexf files into R and how to turn an igraph object into something more suited for d3. I have trying a new approach to making code available when I am working at any of the various various project locations I may find myself. It is often hard to get new packages so I often find myself working on a function or two and then needing it. I have placed an import function into my Rprofile that allows me to pull them from my webiste directly and only what I need. It may be a little flakey compared to a full blown package on CRAN or even on Github, but it works. You can get the core of what I used here.</p>

<pre class="r"><code>
devtools::source_url('https://raw.githubusercontent.com/darrkj/home/gh-pages/rcode/import.R')
import('igrpah_2_d3')
import('d3plot')

</code></pre>




<pre class="r"><code>library(igraph)
library(d3Network)

igraph_2_d3 &lt;- function(igr) {
  Source &lt;- c()
  Target &lt;- c()
  
  x &lt;- V(igr)
  for (i in seq(length(E(igr)))) {
    e &lt;- get.edge(igr, i)
    
    s &lt;- if(is.null(x[e[1]]$name)) x[e[1]] else x[e[1]]$name
    t &lt;- if(is.null(x[e[2]]$name)) x[e[2]] else x[e[2]]$name
    Source &lt;- c(Source, s)
    Target &lt;- c(Target, t)
  }
  
  data.frame(Source, Target)
}

load('info.RData')
load('ig.RData')


clean &lt;- function(x) {
  x &lt;- gsub('&lt;link href=\&quot;/images/favicon.ico\&quot; type=\&quot;image/x-icon\&quot; rel=\&quot;icon\&quot;', '', x)
  x &lt;- gsub(' /&gt;&lt;link href=\&quot;/images/favicon.ico\&quot; type=\&quot;image/x-icon\&quot; ', '', x)
  x &lt;- gsub('rel=\&quot;shortcut icon\&quot; /&gt;&lt;meta name=\&quot;keywords\&quot;', '', x)
  x &lt;- gsub(' content=\&quot;social graph, movies, social network, moviegalaxies, ', '', x)
  x &lt;- gsub('\&quot; /&gt;', '', x)
  x &lt;- gsub('&lt;!-- G+ --&gt;', '', x, fixed = T)
  ind &lt;- as.numeric(gregexpr('&lt;meta name', x))
  x &lt;- substr(x, 1, ind-1)
  x
}

nodeAttr &lt;- function(graph) {
  data.frame(
    name = vertex.attributes(graph)$name,
    degree = centralization.degree(graph)$res,
    closeness = centralization.closeness(graph)$res,
    betweeness = centralization.betweenness(graph, directed = FALSE)$res,
    eigenvector = centralization.evcent(graph, directed = FALSE)$vector)
}


graphAttr &lt;- function(graph) { data.frame(
  Property = c('Degree Centralization', 'Closeness Centralization',
               'Betweenness Centralization', 'Eigenvector Centralization',
               'Assortativity Coefficient', 'Average Path Length',
               'Clique Number', 'Diameter', 'Radius', 'Girth',
               'Adhesion', 'Density', 'Chordal', 'Connected'),
  value = c(centralization.degree(graph)$centralization,
            centralization.closeness(graph)$centralization,
            centralization.betweenness(graph, directed = FALSE)$centralization,
            centralization.evcent(graph, directed = FALSE)$centralization,
            assortativity.degree(graph),
            average.path.length(graph, directed = FALSE, unconnected = TRUE),
            clique.number(graph), diameter(graph),
            radius(graph), girth(graph)$girth,
            graph.adhesion(graph), graph.density(graph),
            is.chordal(graph)$chordal, is.connected(graph)))
}




shinyServer(function(input, output) {
  output$txt &lt;- renderText({ clean(info[[which(names(info) == input$x)]])})

  output$mytable = renderDataTable({
    nodeAttr(ig[[input$x]])
  }, options = list(aLengthMenu = c(5, 30, 50), iDisplayLength = 5))
  
  output$mytable2 = renderDataTable({
    graphAttr(ig[[input$x]])
  }, options = list(aLengthMenu = c(5, 30, 50), iDisplayLength = 5))
  
  output$networkPlot &lt;- renderPrint({    
    d3SimpleNetwork(igraph_2_d3(ig[[input$x]]), 
                    width = 500, height = 350,
                    textColour = 'orange', linkColour = 'red',
                    parentElement = '#networkPlot')
  })
})</code></pre>
<p>Note that the <code>echo = FALSE</code> parameter was added to the code chunk to prevent printing of the R code that generated the plot.</p>
<pre class="r"><code>library(shiny)
load('info.RData')

shinyUI(fluidPage(
  tags$head(
    tags$script(src = 'd3.min.js')
  ),  
  
  titlePanel(&quot;Movie Network&quot;),

  mainPanel(
    selectInput('x','Select Movie', setdiff(names(info), c(&quot;12&quot;, &quot;1492: Conquest of Paradise&quot;))),
    textOutput('txt', container = div),

    htmlOutput('networkPlot'),
    h2('Graph Properties'),
    tabsetPanel(
      tabPanel('Nodes',
               dataTableOutput('mytable')),
      tabPanel('Graph',
               dataTableOutput(&quot;mytable2&quot;))
    )
  )
))</code></pre>

</div>


<div style="text-align:center;"> <iframe src="https://darrkj.shinyapps.io/ioApp/" width="700" height="700"></iframe></div>







<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

<!-- dynamically load mathjax for compatibility with --self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>

